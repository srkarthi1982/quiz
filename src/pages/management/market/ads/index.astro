---
import LayoutSidebar from '../../../../app/LayoutFull.astro';
import Drawer from "../../../../component/Drawer.astro";
import Pagination from "../../../../component/Pagination.astro";
import Sorting from "../../../../component/Sorting.astro";
import Breadcrumb from '../../../../component/Breadcrumb.astro';
import FilterCheckbox from "../../../../component/FilterCheckbox.astro";
import FilterSearch from '../../../../component/FilterSearch.astro';
import ActionButton from '../../../../component/ActionButton.astro';
import Form from "./form.astro";
const { accessCodes } = Astro.locals;
const hasManage = accessCodes?.includes('001.02.01.01');
---
<LayoutSidebar active="ads">
	<Breadcrumb list={[{ name: "Management", link: "management" },{ name: "Ads", link: "" }]}>
		<div class="flex flex-row gap-3">
			<Sorting storeName="ads" columns="columns" />
			<button class="btn-icon white lg" x-on:click="$store.ads.onInit(window.location)"><i class="fas fa-sync-alt"></i></button>
			<button class="btn-icon active lg" x-on:click="$store.ads.onInsert()"><i class="fas fa-plus"></i></button>
		</div>
	</Breadcrumb>
	<div class="table-responsive paper">
		<table class="table border strip">
			<thead>
				<tr>
					<th x-show={`${hasManage}`}></th>
					<th>Active</th>
					<th>Verified</th>
					<th>Featured</th>
					<th>Ad Title</th>
					<th>Store Name</th>
					<th>Ad Types</th>
					<th>Categories</th>
					<th>SubCategories</th>
					<th>Services</th>
					<th>SubServices</th>
					<th>Country</th>
					<th>States</th>
					<th>Cities</th>
					<th>CreatedAt</th>
					<th>UpdatedAt</th>
				</tr>
				<tr>
					<th x-show={`${hasManage}`}></th>
					<th><FilterCheckbox storeName="ads" column="is_active"/></th>
					<th><FilterCheckbox storeName="ads" column="is_verified"/></th>
					<th><FilterCheckbox storeName="ads" column="is_featured"/></th>
					<th><FilterSearch storeName="ads" ref="searchName" method="search" column="name" placeholder="Name"/></th>
					<th><FilterSearch storeName="ads" ref="searchStore" method="search" column="store_name" placeholder="Store"/></th>
					<th class="min-w-36">
						<label for="ad_types" class="sr-only">Filter by Ad Types</label>
						<select 
							id="ad_types"
							class="input w-full" 
							:value="$store.ads.filters.ad_type_id"
							@change="$store.ads.onColumnListChange('ad_type_id', Number($el.value))">
							<option value="">All</option>
							<template x-for={`i in $store.ads.column.ad_types`}>
								<option :value="i.id" x-text="i.name"></option>
							</template>
						</select>
					</th>
					<th class=" min-w-36">
						<label for="category" class="sr-only">Filter by Cateogry</label>
						<select 
							id="category"
							class="input w-full" 
							:value="$store.ads.filters.category_id"
							@change="$store.ads.onColumnCategoryChange(Number($el.value))">
							<option value="">All</option>
							<template x-for={`i in $store.ads.column.categories`}>
								<option :value="i.id" x-text="i.name"></option>
							</template>
						</select>
					</th>
					<th class=" min-w-36">
						<label for="subcategory" class="sr-only">Filter by Sub Category</label>
						<select 
							id="subcategory"
							class="input w-full" 
							:value="$store.ads.filters.subcategory_id"
							@change="$store.ads.onColumnListChange('subcategory_id', Number($el.value))">
							<option value="">All</option>
							<template x-for={`i in $store.ads.column.subcategories`}>
								<option :value="i.id" x-text="i.name"></option>
							</template>
						</select>
					</th>
					<th class=" min-w-36">
						<label for="service" class="sr-only">Filter by Service</label>
						<select 
							id="service"
							class="input w-full" 
							:value="$store.ads.filters.service_id"
							@change="$store.ads.onColumnServiceChange(Number($el.value))">
							<option value="">All</option>
							<template x-for={`i in $store.ads.column.services`}>
								<option :value="i.id" x-text="i.name"></option>
							</template>
						</select>
					</th>
					<th class=" min-w-36">
						<label for="subservice" class="sr-only">Filter by Sub Service</label>
						<select 
							id="subservice"
							class="input w-full" 
							:value="$store.ads.filters.subservice_id"
							@change="$store.ads.onColumnListChange('subservice_id', Number($el.value))">
							<option value="">All</option>
							<template x-for={`i in $store.ads.column.subservices`}>
								<option :value="i.id" x-text="i.name"></option>
							</template>
						</select>
					</th>
					<th class=" min-w-36">
						<label for="country" class="sr-only">Filter by Country</label>
						<select 
							id="country"
							class="input w-full" 
							:value="$store.ads.filters.country_id"
							@change="$store.ads.onColumnCountryChange(Number($el.value))">
							<option value="">All</option>
							<template x-for={`i in $store.ads.column.countries`}>
								<option :value="i.id" x-text="i.name"></option>
							</template>
						</select>
					</th>
					<th class=" min-w-36">
						<label for="state" class="sr-only">Filter by State</label>
						<select 
							id="state"
							class="input w-full" 
							:value="$store.ads.filters.state_id"
							@change="$store.ads.onColumnStateChange(Number($el.value))">
							<option value="">All</option>
							<template x-for={`i in $store.ads.column.states`}>
								<option :value="i.id" x-text="i.name"></option>
							</template>
						</select>
					</th>
					<th class=" min-w-36">
						<label for="city" class="sr-only">Filter by City</label>
						<select 
							id="city"
							class="input w-full" 
							:value="$store.ads.filters.city_id"
							@change="$store.ads.onColumnListChange('city_id', Number($el.value))">
							<option value="">All</option>
							<template x-for={`i in $store.ads.column.cities`}>
								<option :value="i.id" x-text="i.name"></option>
							</template>
						</select>
					</th>
					<th class="text-center">
						<label for="created_at" class="sr-only">Filter by Created At</label>
						<input id="created_at" type="date" :value="$store.ads.filters.created_at" @change="$store.ads.onColumnListChange('created_at', $el.value)" class="input w-32">
					</th>
					<th class="text-center">
						<label for="updated_at" class="sr-only">Filter by Updated At</label>
						<input id="updated_at" type="date" :value="$store.ads.filters.updated_at" @change="$store.ads.onColumnListChange('updated_at', $el.value)" class="input w-32">
					</th>
				</tr>
			</thead>
			<tbody x-show="$store.ads.items.length > 0">
				<template x-for="r in $store.ads.items" :key="r.id">
					<tr>
						<td x-show={`${hasManage}`} class="flex justify-center">
							<ActionButton position="bottom" show={`r.showAction`} 
								actions={[
									{ label: 'Edit', click: `$store.ads.onEdit(r)`, show: hasManage },
									{ label: 'Delete', click: `$store.ads.onDelete(r)`, show: hasManage },
									{ label: 'Copy ID', click: `$store.ads.copyId(r.id)`, show: hasManage }
								]} 
							/>
						</td>
						<td class="text-center">
							<i :class="`fas ${r.is_active ? 'fa-check text-green-500' : 'fa-times text-red-500'}`"></i>
						</td>
						<td class="text-center">
							<i :class="`fas ${r.is_verified ? 'fa-check text-green-500' : 'fa-times text-red-500'}`"></i>
						</td>
						<td class="text-center">
							<i :class="`fas ${r.is_featured ? 'fa-check text-green-500' : 'fa-times text-red-500'}`"></i>
						</td>
						<td x-text="r.name"></td>
						<td x-text="r.store_name"></td>
						<td x-text="r.ad_type_name"></td>
						<td x-text="r.category_name"></td>
						<td x-text="r.subcategory_name"></td>
						<td x-text="r.service_name"></td>
						<td x-text="r.subservice_name"></td>
						<td x-text="r.country_name"></td>
						<td x-text="r.state_name"></td>
						<td x-text="r.city_name"></td>
						<td class="text-center" x-text="$store.ads.ddmmyyyy(r.created_at)"></td>
						<td class="text-center" x-text="$store.ads.ddmmyyyy(r.updated_at)"></td>
					</tr> 
				</template>    
			</tbody>
		</table>
	</div>
	<div class="spacer"></div>
	<Pagination storeName="ads" />
	<Drawer style="drawer-full" item="$store.ads.item" title="Store" showDrawer="$store.ads.showDrawer">
		<Form item="$store.ads.item" hasManage={hasManage} />
	</Drawer>
</LayoutSidebar>
